<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pedido Moderno</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
    body {
        font-family: "Poppins", sans-serif;
        margin: 0;
        padding: 20px;
        background: #f5f5f5;
        color: #333;
    }

    h2 {
        text-align: center;
        font-weight: 700;
        margin-bottom: 20px;
    }

    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 20px;
        margin-bottom: 25px;
    }

    .card {
        background: white;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        transition: transform .2s;
    }

    .card:hover {
        transform: scale(1.03);
    }

    .card img {
        width: 100%;
        height: 150px;
        object-fit: cover;
    }

    .card-body {
        padding: 12px 16px;
    }

    .card-body h4 {
        margin: 0 0 5px;
    }

    .card-body p {
        margin: 0 0 10px;
        font-size: 14px;
        opacity: .8;
    }

    .btn-agregar {
        background: #ff3b3f;
        color: white;
        border: none;
        padding: 10px 16px;
        border-radius: 8px;
        cursor: pointer;
        width: 100%;
        font-size: 15px;
        transition: background .2s;
    }

    .btn-agregar:hover {
        background: #d63235;
    }

    ul {
        list-style: none;
        padding: 0;
    }

    li {
        background: white;
        padding: 10px 12px;
        border-radius: 10px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }

    .btn-mini {
        padding: 4px 8px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        margin-left: 5px;
        font-size: 14px;
    }

    .total {
        margin-top: 20px;
        font-size: 22px;
        font-weight: 700;
        text-align: center;
    }

    .btn-enviar {
        margin-top: 15px;
        width: 100%;
        padding: 14px;
        background: #0077ff;
        color: white;
        font-size: 18px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
    }

</style>
</head>
<body>
<h2>MenÃº del DÃ­a</h2>
<div class="grid" id="menu"></div>

<h3>Tu lista:</h3>
<ul id="listaSeleccion"></ul>
<p class="total">TOTAL: <span id="total">0</span> Bs</p>
<button class="btn-enviar" id="btnEnviar">Enviar al bot</button>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

// Comidas con imÃ¡genes reales
const items = [
    // Entradas
    {categoria:"Entradas", nombre:"Ensalada Fresca", precio:12, desc:"Vegetales mixtos con aderezo.", img:"https://images.unsplash.com/photo-1550304943-4f24f54ddde9"},
    {categoria:"Entradas", nombre:"Sopa de Pollo", precio:10, desc:"Caliente y casera.", img:"https://images.unsplash.com/photo-1604908177522-c8d0f6db0f88"},
    {categoria:"Entradas", nombre:"Bruschetta", precio:14, desc:"Pan tostado con tomate y albahaca.", img:"https://images.unsplash.com/photo-1604908177221-fd8e4e3b6d2d"},
    {categoria:"Entradas", nombre:"Guacamole", precio:13, desc:"Aguacate fresco con nachos.", img:"https://images.unsplash.com/photo-1525755662778-989d0524087e"},
    {categoria:"Entradas", nombre:"Tacos Light", precio:16, desc:"Tortillas suaves con vegetales.", img:"https://images.unsplash.com/photo-1610440042657-612c61ea7b7a"},

    // Segundos
    {categoria:"Segundos", nombre:"Pollo a la Plancha", precio:22, desc:"Servido con arroz y ensalada.", img:"https://images.unsplash.com/photo-1605478371319-e87df6f53017"},
    {categoria:"Segundos", nombre:"Pique Macho", precio:28, desc:"Carne, papas y mÃ¡s.", img:"https://images.unsplash.com/photo-1601050690597-e1e287b9c3c5"},
    {categoria:"Segundos", nombre:"Lasagna", precio:25, desc:"ClÃ¡sica italiana con queso gratinado.", img:"https://images.unsplash.com/photo-1604908554168-324aabd06860"},
    {categoria:"Segundos", nombre:"Lomo Saltado", precio:27, desc:"Carne salteada con vegetales.", img:"https://images.unsplash.com/photo-1632738414058-19e7813e46a6"},
    {categoria:"Segundos", nombre:"Parrilla Mixta", precio:35, desc:"Carnes a la brasa variadas.", img:"https://images.unsplash.com/photo-1551504734-5ee1e6a9cd63"},

    // Postres
    {categoria:"Postres", nombre:"Torta Chocolate", precio:15, desc:"Suave y cremosa.", img:"https://images.unsplash.com/photo-1578985545062-69928b1d9587"},
    {categoria:"Postres", nombre:"Gelatina Mixta", precio:7, desc:"Ligera y dulce.", img:"https://images.unsplash.com/photo-1621996346565-cbd7bf6f1e30"},
    {categoria:"Postres", nombre:"Cheesecake", precio:18, desc:"ClÃ¡sico y cremoso.", img:"https://images.unsplash.com/photo-1541976076758-347942db197d"},
    {categoria:"Postres", nombre:"Helado Artesanal", precio:10, desc:"FrÃ­o y delicioso.", img:"https://images.unsplash.com/photo-1521302080372-ee12a7c0e221"},
    {categoria:"Postres", nombre:"Brownie", precio:14, desc:"Chocolate intenso.", img:"https://images.unsplash.com/photo-1578985545062-69928b1d9587"},

    // Bebidas
    {categoria:"Bebidas", nombre:"Jugo de Naranja", precio:8, desc:"Natural y refrescante.", img:"https://images.unsplash.com/photo-1577801599717-6751054a25f8"},
    {categoria:"Bebidas", nombre:"Refresco", precio:6, desc:"Diversos sabores.", img:"https://images.unsplash.com/photo-1613478057326-74359f4238d6"},
    {categoria:"Bebidas", nombre:"CafÃ© Americano", precio:9, desc:"Caliente y aromÃ¡tico.", img:"https://images.unsplash.com/photo-1495474472287-4d71bcdd2085"},
    {categoria:"Bebidas", nombre:"TÃ© Helado", precio:7, desc:"FrÃ­o y dulce.", img:"https://images.unsplash.com/photo-1510627498534-cf7e9002facc"},
    {categoria:"Bebidas", nombre:"Limonada", precio:8, desc:"Casera y fresca.", img:"https://images.unsplash.com/photo-1521996319423-83dfb0a7d0e1"}
];


let listaProductos = [];

function renderMenu() {
    const cont = document.getElementById("menu");
    cont.innerHTML = "";

    items.forEach((p) => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
            <img src="${p.img}" />
            <div class="card-body">
                <h4>${p.nombre} (${p.categoria})</h4>
                <p>${p.desc}</p>
                <strong>${p.precio} Bs</strong>
                <button class="btn-agregar">Agregar</button>
            </div>`;

        card.querySelector(".btn-agregar").onclick = () => agregarProducto(p);
        cont.appendChild(card);
    });
}

function agregarProducto(prod) {
    const existing = listaProductos.find(p => p.nombre === prod.nombre);
    if (existing) existing.cantidad++;
    else listaProductos.push({...prod, cantidad: 1});
    renderLista();
}

function calcularTotal() {
    const total = listaProductos.reduce((acc, p) => acc + p.precio * p.cantidad, 0);
    document.getElementById("total").textContent = total.toFixed(2);
    return total.toFixed(2);
}

function renderLista() {
    const lista = document.getElementById("listaSeleccion");
    lista.innerHTML = "";

    listaProductos.forEach((item, index) => {
        const li = document.createElement("li");
        li.innerHTML = `${item.nombre} - ${item.precio} Bs x ${item.cantidad}`;

        const btnMas = document.createElement("button");
        btnMas.textContent = "+";
        btnMas.className = "btn-mini";
        btnMas.onclick = () => { item.cantidad++; renderLista(); };

        const btnMenos = document.createElement("button");
        btnMenos.textContent = "-";
        btnMenos.className = "btn-mini";
        btnMenos.onclick = () => {
            if (item.cantidad > 1) item.cantidad--;
            else listaProductos.splice(index, 1);
            renderLista();
        };

        const btnEliminar = document.createElement("button");
        btnEliminar.textContent = "X";
        btnEliminar.className = "btn-mini";
        btnEliminar.onclick = () => { listaProductos.splice(index, 1); renderLista(); };

        li.appendChild(btnMas);
        li.appendChild(btnMenos);
        li.appendChild(btnEliminar);

        lista.appendChild(li);
    });

    calcularTotal();
}

// Enviar al bot
document.getElementById("btnEnviar").onclick = async () => {
    if (listaProductos.length === 0) return alert("Agrega algo primero.");

    let mensaje = "ðŸ§¾ *Tu pedido*\n\n";
    listaProductos.forEach(p => {
        mensaje += `â€¢ ${p.nombre} - ${p.cantidad} x ${p.precio} Bs = ${(p.cantidad * p.precio).toFixed(2)} Bs\n`;
    });

    const total = calcularTotal();
    mensaje += `\nðŸ’° *TOTAL:* ${total} Bs`;

    try {
        const resp = await fetch("/enviar", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                mensaje: mensaje,
                total: total,
                chat_id: tg.initDataUnsafe.user.id
            })
        });
        tg.close();
    } catch (e) {
        alert("Error enviando pedido.");
    }
};

renderMenu();
</script>
</body>
</html>
